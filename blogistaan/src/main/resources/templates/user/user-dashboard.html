<!doctype html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">

<head>
  <meta charset="UTF-8" />
  <title th:text="${title}">Document</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

  <link rel="stylesheet" th:href="@{/css/user-dashboard.css}" href="" />
  <link rel="stylesheet" th:href="@{/css/templatemo-main.css}" />
  <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
  <link rel="stylesheet" th:href="@{/css/fontAwesome.css}">
  <link rel="stylesheet" th:href="@{/css/hero-slider.css}">
  <link rel="stylesheet" th:href="@{/css/owl-carousel.css}">


  <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://kit.fontawesome.com/fc383a6465.js" crossorigin="anonymous"></script>
</head>

<body>

 <!--  <div th:insert="fragments/fragment-file :: navbarTopAndSide"></div> -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top py-3 mynav" style=" background-color:#23120b; font-size:15px;">
	    <a class="navbar-brand" href="#">Navbar</a>
	    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
	      <span class="navbar-toggler-icon"></span>
	    </button>
	    <div class="collapse navibar navbar-collapse" id="navbarSupportedContent">
	      <ul class="navbar-nav ml-auto">
	        <li class="nav-item active">
	          <a class="nav-link" th:href="@{/home}">Home <span class="sr-only">(current)</span></a>
	        </li>
	        <li class="nav-item">
	          <a class="nav-link" th:href="@{#about}">About</a>
	          </li>
	          <li class="nav-item">
	            <a class="nav-link" href="#latest-blogs">Blogs</a>
	          </li>
	          <li class="nav-item">
	            <!-- <a class="nav-link" href="#">Login</a> -->
	            <form method="post" th:action="@{/signin}">
	            <button class="btn nav-link" style="background-color:#fff; height:34px; font-size:12px; color:black; " type="submit" name="login-button">Login</button>
	            </form>
	          </li>
	          <li class="nav-item">
	           <form th:action="@{/signup}" method="get">
	           <button class="btn nav-link" style="background-color:#fff; height:34px; font-size:12px; color:black; " type="submit" name="register-button">Register</button>
	           </form> 
	           </li>
	      </ul>
	      </div>
	    </nav>
	
	
	<div th:if="${blog1}">
<!-- <h1  th:text="${message.content}"></h1> -->

		<aside>
						
			<div>
					<div class="navulli"><a class="navullia" href="#">Create Blog <i class="fas fa-chevron-down"></i></a>
						<div class="navulliul">
							<div th:if="${blogDetails}" th:each="blog: ${blogDetails}">
							<div class="navulliulli"><a class="navulliullia navullia" th:text="${blog.blogName}" th:href="@{'/user/index/' + ${blog.bId}}">1 tester</a></div>
							</div>
							<div class="dropdown-divider"></div>
							<div class="navulliulli"><a class="navulliullia navullia trigger_popup_fricc" href="#">Add Blog</a></div>
							
							
							
						</div>	
					</div>
				</div>	
	
	<ul class="ulc">
	
	
	
	<li><div class="icons"><i class="fa fa-home"></i></div><div class="linktitle"><a style="text-decoration:none; color:#5a5b5b;"  th:href="@{/user/index}">Posts</a></div></li>
	<li><div class="icons"><i class="fa fa-home"></i></div><div class="linktitle"><a style="text-decoration:none; color:#5a5b5b;"  th:href="@{ ${blog1 != null} ? '/user/' + ${blog1.bId} + '/addPost': '/user/' + ${blogDetails.get(0).getBId()} + '/addPost' }">Add Post</a></div></li>
	<li><div class="icons"><i class="fa fa-home"></i></div><div class="linktitle"><a style="text-decoration:none; color:#5a5b5b;"  th:href="@{/user/userProfile}"> User profile</a></div></li>
	<!-- <li><div class="icons"><i class="fa fa-group"></i></div><div class="linktitle"><a style="text-decoration:none; color:#5a5b5b;"  th:href="@{/user/edit-user-blogs}"> Edit your blogs</a></div></li>
	<li><div class="icons"><i class="fa fa-user"></i></div><div class="linktitle">Delete your blog</div></li> -->
	<li><div class="icons"><i class="fa fa-sign-out"></i></div><div class="linktitle"><a style="text-decoration:none; color:#5a5b5b;"  th:href="@{/logout}"> Logout</a></div></li>
	
	</ul>
	</aside>
  
  
<div th:if="${message}" style="padding-left:300px; padding-top:100px;">
<h1  th:text="${message.content}"></h1>
</div>
<div th:unless="${message}" style="padding-top:80px; margin:30px; margin-left:250px;">
<input type="hidden" name="bId" th:value="${blog1.bId}" >
<table class="table table-striped" style=" background-color: #fff">
  <thead>
    <tr>
      <th scope="col">ID</th>
      <th scope="col">Title</th>
      <th scope="col">Date</th>
      <th scope="col">Action</th>
    </tr>
  </thead>
  <tbody>
    <tr th:each="p: ${posts}">
      <th scope="row" th:text="${'SCMUSER'+p.postId}"></th>
      <!-- <td > <img class="image-size" th:src="@{'/images/' + ${c.cId}+ '/' + ${c.image}}" alt="" /> -->
      <!-- <form method="post" th:action="@{'/user/userProfile/'+${c.cId}}">
      <button><span th:text="${c.name}" ></span></button> 
      </form> -->
      <!-- </td> -->
      <td th:text="${p.title}"></td>
      <td th:text="${p.date}"></td>
      <td><form th:action="@{'/user/' + ${bId} + '/edit/'+${p.postId}}" method="POST"><button type="submit">Edit</button></form></td>
    </tr>
    
  </tbody>
</table>
</div>

<div class="hover_bkgr_fricc  contact-formation">
    <span class="helper"></span>
    <div class="cetr">
        <div class="popupCloseButton">&times;</div>
        <h2>Please fill the mentioned details for your blog</h2>
        <label for="blog_field">Your Blog Name</label>
        <input type="text"  class="contact-formation-text" id="name_field" name="name" placeholder="Enter your blog name" required="required">
        
        <div style="display:none;" id="namediv1">
	    <label id="namedisplay1" ></label> 
	    <br />
	    </div>
        
        <label for="blog_field">Your Blog URL</label>
        <input type="text"  class="contact-formation-text" id="url_field" name="blogUrl" placeholder="Enter your blog url" required="required">
        
      <!--  <label id="res_message" style="display:none;"></label>  -->
       
       <div style="display:none;" id="namediv">
	    <label id="namedisplay" ></label> 
	    <br />
	    </div>
        
        <label for="country_field">Category</label>
        <div class="input_field select_option contact-formation-text backcol">
          <select required="required" class=" contact-formation-text1" name="category" id="category" >
            <option value="" >Select a category</option>
            <option value="Business">Business</option>
            <option value="Fashion">Fashion</option>
            <option value="Finance">Finance</option>
            <option value="Fitness">Fitness</option>
            <option value="Food">Food</option>
            <option value="Lifestyle">Lifestyle</option>
            <option value="Africa">Music</option>
            <option value="Personal">Personal</option>
            <option value="Political">Political</option>
            <option value="Travel">Travel</option>
            <option value="Sports">Sports</option>
            <option value="Other">Other</option>
          </select>
          <!-- <div class="select_arrow"></div> -->
        </div>
        <div class="btn_wrapper" >
		  <button class="btn btn-outline-dark btns" disabled="disabled">Submit</button>
		</div>
    </div>
</div>

</div>

<div th:unless="${blog1}">
	
			<aside>
						
			<div>
					<div class="navulli"><a class="navullia" href="#">Create Blog <i class="fas fa-chevron-down"></i></a>
						<div class="navulliul">
							<div th:if="${blogDetails}" th:each="blog: ${blogDetails}">
							<div class="navulliulli"><a class="navulliullia navullia" th:text="${blog.blogName}" th:href="@{'/user/index/' + ${blog.bId}}">1 tester</a></div>
							</div>
							<div class="dropdown-divider"></div>
							<div class="navulliulli"><a class="navulliullia navullia trigger_popup_fricc" href="#">Add Blog</a></div>
							
							
							
						</div>	
					</div>
				</div>	
	
	<ul class="ulc">
	
	
	
	<li><div class="icons"><i class="fa fa-home"></i></div><div class="linktitle"><a style="text-decoration:none; color:#5a5b5b;"  th:href="@{/user/index}">Home</a></div></li>
	<li><div class="icons"><i class="fa fa-sign-out"></i></div><div class="linktitle"><a style="text-decoration:none; color:#5a5b5b;"  th:href="@{/logout}"> Logout</a></div></li>
	
	</ul>
	</aside>
	
	
	<div class="hover_bkgr_fricc  contact-formation">
    <span class="helper"></span>
    <div class="cetr">
        <div class="popupCloseButton">&times;</div>
        <h2>Please fill the mentioned details for your blog</h2>
        <label for="blog_field">Your Blog Name</label>
        <input type="text"  class="contact-formation-text" id="name_field" name="name" placeholder="Enter your blog name" required="required">
        
        <div style="display:none;" id="namediv1">
	    <label id="namedisplay1" ></label> 
	    <br />
	    </div>
        
        <label for="blog_field">Your Blog URL</label>
        <input type="text"  class="contact-formation-text" id="url_field" name="blogUrl" placeholder="Enter your blog url" required="required">
        
      <!--  <label id="res_message" style="display:none;"></label>  -->
       
       <div style="display:none;" id="namediv">
	    <label id="namedisplay" ></label> 
	    <br />
	    </div>
        
        <label for="country_field">Category</label>
        <div class="input_field select_option contact-formation-text backcol">
          <select required="required" class=" contact-formation-text1" name="category" id="category" >
            <option value="" >Select a category</option>
            <option value="Business">Business</option>
            <option value="Fashion">Fashion</option>
            <option value="Finance">Finance</option>
            <option value="Fitness">Fitness</option>
            <option value="Food">Food</option>
            <option value="Lifestyle">Lifestyle</option>
            <option value="Africa">Music</option>
            <option value="Personal">Personal</option>
            <option value="Political">Political</option>
            <option value="Travel">Travel</option>
            <option value="Sports">Sports</option>
            <option value="Other">Other</option>
          </select>
          <!-- <div class="select_arrow"></div> -->
        </div>
        <div class="btn_wrapper" >
		  <button class="btn btn-outline-dark btns" disabled="disabled">Submit</button>
		</div>
    </div>
</div>
	
</div>





<!-- <div th:if="${blog1}" style="padding-left:300px; padding-top:100px;"> <h1 th:text="${blog1.bId}"></h1>
<h1 th:text="${blog1.blogName}"></h1>
<h1 th:text="${blog1.blogUrl}"></h1>
</div> -->

<!-- <div th:if="${posts}" th:each="post: ${posts}" style="padding-left:300px; padding-top:100px;"> <h1 th:text="${post.postId}"></h1>
<h1 th:text="${post.title}"></h1>
<h1 th:text="${post.content}"></h1>
<h1 th:text="${post.date}"></h1>
</div> -->





<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script th:src="@{js/vendor/jquery-1.11.2.min.js}"><\/script>')</script>
    <script th:src="@{/js/vendor/bootstrap.min.js}"></script>
    <script th:src="@{/js/plugins.js}"></script>
    <script th:src="@{/js/main.js}"></script> -->
    
    <script th:inline="javascript">
						
						$(document).ready(function() {
						    $(".trigger_popup_fricc").click(function(){
						       $('.hover_bkgr_fricc').show();
						    });
						   /*  $('.hover_bkgr_fricc').click(function(){
						        $('.hover_bkgr_fricc').hide();
						    }); */
						    $('.popupCloseButton').click(function(){
						        $('.hover_bkgr_fricc').hide();
						    });
						    
						   /*  $(".btn_wrapper").hide(); */						    $('#url_field').keyup(function(){
						    	var blogUrl = $('#url_field').val();
							    var url = "/user/checkBlogUrl";
							   /*  var str = $('#url_field').val(); */
							    var regex = /^[A-Za-z0-9]+$/;
							    if(!$("#url_field").val()){
						    		$("#namedisplay").empty();
						    		$("#namediv").hide();
						    		/* $(".btn_wrapper").hide(); */
						    		$(".btns").prop('disabled', true);
						    	}
							    else if(regex.test(blogUrl) == false) {
							       /*  alert('illegal characters.'); */
							    	$("#namediv").show();
									$("#namedisplay").empty();
									$("#namedisplay").append("Illegal character");
						    		/* $(".btn_wrapper").hide(); */
									$(".btns").prop('disabled', true);
							    }
							    else{
							    	/* $(".btn_wrapper").show(); */
							    	$(".btns").prop('disabled', false);
							    	$.ajax({
								    	url: url,
								    	type: "POST",
								    	data: {
								    		blogUrl: blogUrl
								    	},
								    	success : function(response){
								    		$("#namediv").show();
	    									$("#namedisplay").empty();
	    									$("#namedisplay").append(response);
	    									var str = response;
	    									if(str.includes("unavailable")){
	    							    	/* 	$(".btn_wrapper").hide(); */
	    							    	
	    										$(".btns").prop('disabled', true);
	    									}
								    		
								    	},
								    	error : function(){
								    		alert("error message: "+ response);
								    		console.log(response);
								    	}
								    });
								    
							    }
						    });
						   $("#name_field").keyup(function(){
							   var c = $('#name_field').val()[0];
							   console.log("Consolelog:  "+ c);
							   var name = $('#name_field').val();
							   var regex = /^[A-Za-z0-9 -_]+$/;
							   var splchar = /^[A-Za-z0-9]+$/;
							   if(!$("#name_field").val()){
						    		$("#namedisplay1").empty();
						    		$("#namediv1").hide();
						    		/* $(".btn_wrapper").hide(); */
						    		$(".btns").prop('disabled', true);
						    	}
							   else if( (splchar.test($('#name_field').val()[0]) == false) || (regex.test(name) == false)  ) {
							       /*  alert('illegal characters.'); */
							    	$("#namediv1").show();
									$("#namedisplay1").empty();
									$("#namedisplay1").append("Illegal character");
						    		/* $(".btn_wrapper").hide(); */
									$(".btns").prop('disabled', true);
							    }
							   else{
								   $("#namediv1").hide();
								/*    $(".btns").prop('disabled', false); */
							   }
						   });
						   
						  $('.btns').click(function(){
							  var blogName = $('#name_field').val();
							  var blogUrl = $('#url_field').val();
							  var category = $('#category').val();
							  $.ajax({
								  url : "/user/createBlog",
								  type : "POST",
								  async: false,
								  data : {
									  blogName : blogName,
									  blogUrl : blogUrl,
									  category : category
								  },
								  success : function(response){
									  /* console.log("success: " + response); */
									  window.location = '/user/index';
								  },
								  error : function(){
									  console.log("error: "+ response);
								  }
							  });
						  });
						    
						});
						
						</script>
    
</body>
</html>